language: ruby
rvm:
- 2.1
  
# Containers are cool!  
sudo: false

install: 
- bundle install
- pip install --user awscli
- ~/.local/bin/aws configure set preview.cloudfront true
  
# Build and deploy the site to the S3 bucket on push to master, unless PR
script: bundle exec jekyll build
branches:
  only:
  - master
deploy:
  provider: s3
  access_key_id: AKIAJCFW25SXOIBZTZ7Q
  secret_access_key:
    secure: "AY9SVH7fP094iIQoFHyfjg2qME/v6kzh5ElyFTI0oAneZ8p/jr3kVbX6NNIPVg0VM8B5F4HjJXbB/u0DpwZ085JNwiEFelTvBbOZ+SrtwHX5YSoCiWQSd6Lh302o2XRG3LsIiVvSqYfpVZXujVeh1A+7eMmnLmcizF1uLacw8J0VVHkRGeXASQwtTjj90+8HT1mP3LkECIVUVEHKdOAZICbR9nBV5vCj57BoeFCf5CGv8gOrwM8wTu57aXbPO612R3HOVsszhTEMACdCLWKjwtcMb/mKCkw3MJFMPerXoTJ+YeeDJzb7Rom6MnC42XPj430V+hmGSFCWlLVZ0ttICxIFBM7fmtn0Wq2ls8GIrOuvzWHCTUUUwKFiwUnKMcsfXuPA1XJ03OwTqYHipki+pn9f8uh29n6G/J0J5PWD6AeiNZwrn6SqsdzN2oVogiFuhpxT3j/oXMFbS+qwuRoMV9qzLYp8Nl9sHFQjQtG1Pxz7fhJrviwqrpHEJmq59JSvx3Q+H8a+TDeqlZgg1qBBfePBHzs/3Q2BOVueqykJT3bjbi9kXMR7Y2BIShUkzRciZ2MNdGcEawcVsN2Ss7ZNR9muNsTJtJZ7jJohb/JV5XxEHZ+0dTLUtsJfGpmIxkTtTlrqbh5jDW77qddvus7k3/SMaBkIQ/wLOg5dqH27t8g="
  bucket: rust-vietnam-www
  acl: public_read
  skip_cleanup: true
  local_dir: _site
  region: ap-southeast-1
  on:
    branch: master
    condition: $TRAVIS_PULL_REQUEST = "false"

after_success: 
- '[[ $TRAVIS_PULL_REQUEST == "false" ]] && python invalidation-list.py'

after_deploy:
- '[[ $TRAVIS_PULL_REQUEST == "false" ]] && ~/.local/bin/aws cloudfront create-invalidation
  --invalidation-batch file://payload.json --distribution-id E2JAXTWKB7NE6G'
